input {
  http {
    port => 12345
    add_field => { "[@metadata][input-http]" => "" }
  }
}

filter {
  if [@metadata][input-http] {
    if ![log_type] {
      mutate { add_field => { "log_type" => "app" } }
    }
    date {
      match => [ "date", "UNIX" ]
      remove_field => [ "date" ]
    }
    mutate {
    #   remove_field	=> ["headers","host"]
      remove_field => [
        "http.method",
        "http.request.body.bytes",
        "http.request.mime_type",
        "http.version",
        "source",
        "url.domain",
        "url.path",
        "url.port",
        "user_agent.original"
      ]
    }
    grok {
      match => { "log" => "%{TIMESTAMP_ISO8601:timestamp} %{LOGLEVEL:loglevel} %{GREEDYDATA:message}" }
      remove_field => ["log"]
    }
  }
}

output {
  opensearch {
    hosts => ["opensearch:9200"]
    index => "opensearch-logstash-docker-%{+YYYY.MM.dd}"
    user => "admin"
    password => "${OPENSEARCH_ADMIN_PASSWORD}"
    ssl_certificate_verification => false
    ssl => true
  }
}
